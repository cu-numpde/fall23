

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>2023-10-30 Finite Element Theory &#8212; Numerical Solution of Partial Differential Equations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'slides/2023-10-30-fem';</script>
    <link rel="shortcut icon" href="../_static/cu-numpde-square.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2023-11-01 Finite Elements" href="2023-11-01-fem.html" />
    <link rel="prev" title="2023-10-25 Galerkin methods" href="2023-10-25-galerkin.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/cu-numpde.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/cu-numpde.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../slides.html">Slides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2023-08-28-first-day.html">2023-08-28 First Day</a></li>
















<li class="toctree-l2"><a class="reference internal" href="2023-08-30-finite-differences.html">2023-08-30 Finite Differences</a></li>






<li class="toctree-l2"><a class="reference internal" href="2023-09-01-fd-solutions.html">2023-09-01 FD Solutions</a></li>


















<li class="toctree-l2"><a class="reference internal" href="2023-09-06-fd-verification.html">2023-09-06 FD Verification</a></li>























<li class="toctree-l2"><a class="reference internal" href="2023-09-08-fourier.html">2023-09-08 Fourier and conditioning</a></li>





















<li class="toctree-l2"><a class="reference internal" href="2023-09-11-chebyshev.html">2023-09-11 Chebyshev collocation</a></li>


















<li class="toctree-l2"><a class="reference internal" href="2023-09-13-coefficients.html">2023-09-13 Variable coefficients</a></li>

















<li class="toctree-l2"><a class="reference internal" href="2023-09-15-advection.html">2023-09-15 Advection</a></li>











<li class="toctree-l2"><a class="reference internal" href="2023-09-18-sparsity.html">2023-09-18 Sparsity and solvers</a></li>

























<li class="toctree-l2"><a class="reference internal" href="2023-09-20-nonlinear.html">2023-09-20 Nonlinear solvers</a></li>























<li class="toctree-l2"><a class="reference internal" href="2023-09-22-differentiation.html">2023-09-22 Differentiation</a></li>

















<li class="toctree-l2"><a class="reference internal" href="2023-09-25-blasius.html">2023-09-25 Blasius</a></li>








<li class="toctree-l2"><a class="reference internal" href="2023-09-27-transient.html">2023-09-27 Transient Intro</a></li>




<li class="toctree-l2"><a class="reference internal" href="2023-09-29-transient.html">2023-09-29 Transient</a></li>














<li class="toctree-l2"><a class="reference internal" href="2023-10-02-stiffness.html">2023-10-02 Stiffness</a></li>












<li class="toctree-l2"><a class="reference internal" href="2023-10-04-runge-kutta.html">2023-10-04 Runge-Kutta</a></li>






















<li class="toctree-l2"><a class="reference internal" href="2023-10-06-2d.html">2023-10-06 2D Advection-diffusion and waves</a></li>











<li class="toctree-l2"><a class="reference internal" href="2023-10-09-factorization.html">2023-10-09 Factorization</a></li>






















<li class="toctree-l2"><a class="reference internal" href="2023-10-11-linear-solvers.html">2023-10-11 Linear Solvers</a></li>









<li class="toctree-l2"><a class="reference internal" href="2023-10-13-iterative.html">2023-10-13 Iterative Solvers</a></li>























<li class="toctree-l2"><a class="reference internal" href="2023-10-16-krylov.html">2023-10-16 Krylov and preconditioning</a></li>








<li class="toctree-l2"><a class="reference internal" href="2023-10-18-preconditioning.html">2023-10-18 Preconditioning</a></li>








<li class="toctree-l2"><a class="reference internal" href="2023-10-20-multigrid.html">2023-10-20 Multigrid</a></li>























<li class="toctree-l2"><a class="reference internal" href="2023-10-23-amg.html">2023-10-23 AMG</a></li>












<li class="toctree-l2"><a class="reference internal" href="2023-10-25-galerkin.html">2023-10-25 Galerkin methods</a></li>














<li class="toctree-l2 current active"><a class="current reference internal" href="#">2023-10-30 Finite Element Theory</a></li>













<li class="toctree-l2"><a class="reference internal" href="2023-11-01-fem.html">2023-11-01 Finite Elements</a></li>









<li class="toctree-l2"><a class="reference internal" href="2023-11-03-applied-fe.html">2023-11-03 Applied Finite Elements</a></li>











<li class="toctree-l2"><a class="reference internal" href="2023-11-06-solids.html">2023-11-06 Solid Mechanics</a></li>









<li class="toctree-l2"><a class="reference internal" href="2023-11-08-ratel.html">2023-11-08 Ratel for Solid Mechanics</a></li>






















<li class="toctree-l2"><a class="reference internal" href="2023-11-10-solvers.html">2023-11-10 Ratel Hands-on</a></li>





<li class="toctree-l2"><a class="reference internal" href="2023-11-13-fe-compressible.html">2023-11-13 FE for Compressible flow</a></li>





<li class="toctree-l2"><a class="reference internal" href="2023-11-15-ceed-fluids.html">2023-11-15 CEED Fluids</a></li>












<li class="toctree-l2"><a class="reference internal" href="2023-11-17-finite-volume.html">2023-11-17 Finite Volume</a></li>


















<li class="toctree-l2"><a class="reference internal" href="2023-11-27-reconstruction.html">2023-11-27 Reconstruction</a></li>











<li class="toctree-l2"><a class="reference internal" href="2023-11-29-systems.html">2023-11-29 Systems</a></li>













</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cu-numpde/fall22" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cu-numpde/fall22/issues/new?title=Issue%20on%20page%20%2Fslides/2023-10-30-fem.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/slides/2023-10-30-fem.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2023-10-30 Finite Element Theory</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2023-10-30 Finite Element Theory</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#last-time">Last time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#today">Today</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#prime-to-nodal-basis">Prime to nodal basis</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-method-l-2-projection">Galerkin method: <span class="math notranslate nohighlight">\(L^2\)</span> projection</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#embed-the-solution-in-the-continuous-space">Embed the solution in the continuous space</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-error-estimates">Galerkin error estimates</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-optimality-via-energy-norms">Galerkin optimality via energy norms</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-method-for-poisson">Galerkin method for Poisson</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-we-only-impose-the-boundary-condition-on-one-side">What if we only impose the boundary condition on one side?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-preserves-symmetry">Galerkin preserves symmetry</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-we-use-too-few-quadrature-points">What if we use too few quadrature points?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#general-form">General form</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isoparametric-mapping">Isoparametric mapping</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-mesh-and-restriction">Finite element mesh and restriction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-building-blocks">Finite element building blocks</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-residual-assembly">Finite element residual assembly</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-jacobian-assembly">Finite element Jacobian assembly</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#spy-on-the-jacobian">Spy on the Jacobian</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="finite-element-theory">
<h1>2023-10-30 Finite Element Theory<a class="headerlink" href="#finite-element-theory" title="Permalink to this heading">#</a></h1>
<section id="last-time">
<h2>Last time<a class="headerlink" href="#last-time" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Questions about projects</p></li>
<li><p>Galerkin methods</p>
<ul>
<li><p>Weak forms</p></li>
<li><p><span class="math notranslate nohighlight">\(L^2\)</span> Projection</p></li>
<li><p>Galerkin “optimality”</p></li>
</ul>
</li>
</ul>
</section>
<section id="today">
<h2>Today<a class="headerlink" href="#today" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Galerkin for Poisson</p></li>
<li><p>Finite element constructions</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">Plots</span>
<span class="n">default</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>
<span class="k">using</span><span class="w"> </span><span class="n">SparseArrays</span>

<span class="k">function</span><span class="w"> </span><span class="n">my_spy</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
<span class="w">    </span><span class="n">cmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="nb">Inf</span><span class="p">)</span>
<span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="mi">120</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
<span class="w">    </span><span class="n">spy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="p">(</span><span class="ss">:square</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">),</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="ss">:diverging_rainbow_bgymr_45_85_c67_n256</span><span class="p">,</span><span class="w"> </span><span class="n">clims</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">cmax</span><span class="p">,</span><span class="w"> </span><span class="n">cmax</span><span class="p">))</span>
<span class="k">end</span>


<span class="k">function</span><span class="w"> </span><span class="n">vander_legendre</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">isnothing</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">        </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c"># Square by default</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">    </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span>
<span class="w">        </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">Q</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vander_legendre (generic function with 2 methods)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="prime-to-nodal-basis">
<h1>Prime to nodal basis<a class="headerlink" href="#prime-to-nodal-basis" title="Permalink to this heading">#</a></h1>
<p>A <strong>nodal basis</strong> <span class="math notranslate nohighlight">\(\{ \phi_j(x) \}\)</span> is one that satisfies
<span class="math notranslate nohighlight">\( n_i(\phi_j) = \delta_{ij} . \)</span></p>
<p>We write <span class="math notranslate nohighlight">\(\phi_j\)</span> in the prime basis by solving with the generalized Vandermonde matrix <span class="math notranslate nohighlight">\(V_{ij} = \langle n_i, p_j \rangle\)</span>,
<div class="math notranslate nohighlight">
\[ \phi_j(x) = \sum_k p_k(x) (V^{-1})_{k,j} . \]</div>
</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span>
<span class="n">xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span>
<span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander_legendre</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span>
<span class="n">xx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
<span class="n">Pxx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander_legendre</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="n">Pn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pxx</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">V</span>
<span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">Pn</span><span class="p">)</span>
<span class="n">scatter!</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="o">.</span><span class="p">(</span><span class="n">xn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip660">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip660)" d="M0 1600 L2400 1600 L2400 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip661">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip660)" d="M147.478 1486.45 L2352.76 1486.45 L2352.76 47.2441 L147.478 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip662">
    <rect x="147" y="47" width="2206" height="1440"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="209.891,1486.45 209.891,47.2441 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="730.004,1486.45 730.004,47.2441 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1250.12,1486.45 1250.12,47.2441 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1770.23,1486.45 1770.23,47.2441 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2290.34,1486.45 2290.34,47.2441 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="147.478,1486.45 2352.76,1486.45 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="209.891,1486.45 209.891,1467.55 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="730.004,1486.45 730.004,1467.55 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1250.12,1486.45 1250.12,1467.55 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1770.23,1486.45 1770.23,1467.55 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2290.34,1486.45 2290.34,1467.55 "/>
<path clip-path="url(#clip660)" d="M156.42 1532.02 L186.095 1532.02 L186.095 1535.95 L156.42 1535.95 L156.42 1532.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M196.998 1544.91 L204.637 1544.91 L204.637 1518.55 L196.327 1520.21 L196.327 1515.95 L204.591 1514.29 L209.266 1514.29 L209.266 1544.91 L216.905 1544.91 L216.905 1548.85 L196.998 1548.85 L196.998 1544.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M226.35 1542.97 L231.234 1542.97 L231.234 1548.85 L226.35 1548.85 L226.35 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M251.419 1517.37 Q247.808 1517.37 245.979 1520.93 Q244.174 1524.47 244.174 1531.6 Q244.174 1538.71 245.979 1542.27 Q247.808 1545.82 251.419 1545.82 Q255.053 1545.82 256.859 1542.27 Q258.687 1538.71 258.687 1531.6 Q258.687 1524.47 256.859 1520.93 Q255.053 1517.37 251.419 1517.37 M251.419 1513.66 Q257.229 1513.66 260.285 1518.27 Q263.363 1522.85 263.363 1531.6 Q263.363 1540.33 260.285 1544.94 Q257.229 1549.52 251.419 1549.52 Q245.609 1549.52 242.53 1544.94 Q239.475 1540.33 239.475 1531.6 Q239.475 1522.85 242.53 1518.27 Q245.609 1513.66 251.419 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M677.03 1532.02 L706.706 1532.02 L706.706 1535.95 L677.03 1535.95 L677.03 1532.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M726.798 1517.37 Q723.187 1517.37 721.358 1520.93 Q719.553 1524.47 719.553 1531.6 Q719.553 1538.71 721.358 1542.27 Q723.187 1545.82 726.798 1545.82 Q730.432 1545.82 732.238 1542.27 Q734.067 1538.71 734.067 1531.6 Q734.067 1524.47 732.238 1520.93 Q730.432 1517.37 726.798 1517.37 M726.798 1513.66 Q732.608 1513.66 735.664 1518.27 Q738.743 1522.85 738.743 1531.6 Q738.743 1540.33 735.664 1544.94 Q732.608 1549.52 726.798 1549.52 Q720.988 1549.52 717.909 1544.94 Q714.854 1540.33 714.854 1531.6 Q714.854 1522.85 717.909 1518.27 Q720.988 1513.66 726.798 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M746.96 1542.97 L751.844 1542.97 L751.844 1548.85 L746.96 1548.85 L746.96 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M762.076 1514.29 L780.432 1514.29 L780.432 1518.22 L766.358 1518.22 L766.358 1526.7 Q767.377 1526.35 768.395 1526.19 Q769.414 1526 770.432 1526 Q776.219 1526 779.599 1529.17 Q782.978 1532.34 782.978 1537.76 Q782.978 1543.34 779.506 1546.44 Q776.034 1549.52 769.715 1549.52 Q767.539 1549.52 765.27 1549.15 Q763.025 1548.78 760.617 1548.04 L760.617 1543.34 Q762.701 1544.47 764.923 1545.03 Q767.145 1545.58 769.622 1545.58 Q773.627 1545.58 775.965 1543.48 Q778.303 1541.37 778.303 1537.76 Q778.303 1534.15 775.965 1532.04 Q773.627 1529.94 769.622 1529.94 Q767.747 1529.94 765.872 1530.35 Q764.02 1530.77 762.076 1531.65 L762.076 1514.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M1227.5 1517.37 Q1223.89 1517.37 1222.06 1520.93 Q1220.26 1524.47 1220.26 1531.6 Q1220.26 1538.71 1222.06 1542.27 Q1223.89 1545.82 1227.5 1545.82 Q1231.14 1545.82 1232.94 1542.27 Q1234.77 1538.71 1234.77 1531.6 Q1234.77 1524.47 1232.94 1520.93 Q1231.14 1517.37 1227.5 1517.37 M1227.5 1513.66 Q1233.31 1513.66 1236.37 1518.27 Q1239.45 1522.85 1239.45 1531.6 Q1239.45 1540.33 1236.37 1544.94 Q1233.31 1549.52 1227.5 1549.52 Q1221.69 1549.52 1218.61 1544.94 Q1215.56 1540.33 1215.56 1531.6 Q1215.56 1522.85 1218.61 1518.27 Q1221.69 1513.66 1227.5 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M1247.66 1542.97 L1252.55 1542.97 L1252.55 1548.85 L1247.66 1548.85 L1247.66 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M1272.73 1517.37 Q1269.12 1517.37 1267.29 1520.93 Q1265.49 1524.47 1265.49 1531.6 Q1265.49 1538.71 1267.29 1542.27 Q1269.12 1545.82 1272.73 1545.82 Q1276.37 1545.82 1278.17 1542.27 Q1280 1538.71 1280 1531.6 Q1280 1524.47 1278.17 1520.93 Q1276.37 1517.37 1272.73 1517.37 M1272.73 1513.66 Q1278.54 1513.66 1281.6 1518.27 Q1284.68 1522.85 1284.68 1531.6 Q1284.68 1540.33 1281.6 1544.94 Q1278.54 1549.52 1272.73 1549.52 Q1266.92 1549.52 1263.84 1544.94 Q1260.79 1540.33 1260.79 1531.6 Q1260.79 1522.85 1263.84 1518.27 Q1266.92 1513.66 1272.73 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M1748.11 1517.37 Q1744.5 1517.37 1742.67 1520.93 Q1740.87 1524.47 1740.87 1531.6 Q1740.87 1538.71 1742.67 1542.27 Q1744.5 1545.82 1748.11 1545.82 Q1751.75 1545.82 1753.55 1542.27 Q1755.38 1538.71 1755.38 1531.6 Q1755.38 1524.47 1753.55 1520.93 Q1751.75 1517.37 1748.11 1517.37 M1748.11 1513.66 Q1753.92 1513.66 1756.98 1518.27 Q1760.06 1522.85 1760.06 1531.6 Q1760.06 1540.33 1756.98 1544.94 Q1753.92 1549.52 1748.11 1549.52 Q1742.3 1549.52 1739.22 1544.94 Q1736.17 1540.33 1736.17 1531.6 Q1736.17 1522.85 1739.22 1518.27 Q1742.3 1513.66 1748.11 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M1768.27 1542.97 L1773.16 1542.97 L1773.16 1548.85 L1768.27 1548.85 L1768.27 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M1783.39 1514.29 L1801.75 1514.29 L1801.75 1518.22 L1787.67 1518.22 L1787.67 1526.7 Q1788.69 1526.35 1789.71 1526.19 Q1790.73 1526 1791.75 1526 Q1797.53 1526 1800.91 1529.17 Q1804.29 1532.34 1804.29 1537.76 Q1804.29 1543.34 1800.82 1546.44 Q1797.35 1549.52 1791.03 1549.52 Q1788.85 1549.52 1786.58 1549.15 Q1784.34 1548.78 1781.93 1548.04 L1781.93 1543.34 Q1784.01 1544.47 1786.24 1545.03 Q1788.46 1545.58 1790.94 1545.58 Q1794.94 1545.58 1797.28 1543.48 Q1799.62 1541.37 1799.62 1537.76 Q1799.62 1534.15 1797.28 1532.04 Q1794.94 1529.94 1790.94 1529.94 Q1789.06 1529.94 1787.19 1530.35 Q1785.33 1530.77 1783.39 1531.65 L1783.39 1514.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2257.5 1544.91 L2265.13 1544.91 L2265.13 1518.55 L2256.82 1520.21 L2256.82 1515.95 L2265.09 1514.29 L2269.76 1514.29 L2269.76 1544.91 L2277.4 1544.91 L2277.4 1548.85 L2257.5 1548.85 L2257.5 1544.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2286.85 1542.97 L2291.73 1542.97 L2291.73 1548.85 L2286.85 1548.85 L2286.85 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2311.92 1517.37 Q2308.31 1517.37 2306.48 1520.93 Q2304.67 1524.47 2304.67 1531.6 Q2304.67 1538.71 2306.48 1542.27 Q2308.31 1545.82 2311.92 1545.82 Q2315.55 1545.82 2317.36 1542.27 Q2319.18 1538.71 2319.18 1531.6 Q2319.18 1524.47 2317.36 1520.93 Q2315.55 1517.37 2311.92 1517.37 M2311.92 1513.66 Q2317.73 1513.66 2320.78 1518.27 Q2323.86 1522.85 2323.86 1531.6 Q2323.86 1540.33 2320.78 1544.94 Q2317.73 1549.52 2311.92 1549.52 Q2306.11 1549.52 2303.03 1544.94 Q2299.97 1540.33 2299.97 1531.6 Q2299.97 1522.85 2303.03 1518.27 Q2306.11 1513.66 2311.92 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="147.478,1356.69 2352.76,1356.69 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="147.478,1077.81 2352.76,1077.81 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="147.478,798.938 2352.76,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="147.478,520.062 2352.76,520.062 "/>
<polyline clip-path="url(#clip662)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="147.478,241.186 2352.76,241.186 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="147.478,1486.45 147.478,47.2441 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="147.478,1356.69 166.376,1356.69 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="147.478,1077.81 166.376,1077.81 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="147.478,798.938 166.376,798.938 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="147.478,520.062 166.376,520.062 "/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="147.478,241.186 166.376,241.186 "/>
<path clip-path="url(#clip660)" d="M51.3625 1357.14 L81.0383 1357.14 L81.0383 1361.08 L51.3625 1361.08 L51.3625 1357.14 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M95.1586 1370.03 L111.478 1370.03 L111.478 1373.97 L89.5336 1373.97 L89.5336 1370.03 Q92.1956 1367.28 96.7789 1362.65 Q101.385 1358 102.566 1356.66 Q104.811 1354.13 105.691 1352.4 Q106.594 1350.64 106.594 1348.95 Q106.594 1346.19 104.649 1344.46 Q102.728 1342.72 99.6261 1342.72 Q97.4271 1342.72 94.9734 1343.48 Q92.5428 1344.25 89.7651 1345.8 L89.7651 1341.08 Q92.5891 1339.94 95.0428 1339.36 Q97.4965 1338.79 99.5335 1338.79 Q104.904 1338.79 108.098 1341.47 Q111.293 1344.16 111.293 1348.65 Q111.293 1350.78 110.483 1352.7 Q109.696 1354.6 107.589 1357.19 Q107.01 1357.86 103.909 1361.08 Q100.807 1364.27 95.1586 1370.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M50.9921 1078.27 L80.6679 1078.27 L80.6679 1082.2 L50.9921 1082.2 L50.9921 1078.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M91.5706 1091.16 L99.2095 1091.16 L99.2095 1064.79 L90.8993 1066.46 L90.8993 1062.2 L99.1632 1060.53 L103.839 1060.53 L103.839 1091.16 L111.478 1091.16 L111.478 1095.09 L91.5706 1095.09 L91.5706 1091.16 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M99.5335 784.737 Q95.9224 784.737 94.0937 788.301 Q92.2882 791.843 92.2882 798.973 Q92.2882 806.079 94.0937 809.644 Q95.9224 813.186 99.5335 813.186 Q103.168 813.186 104.973 809.644 Q106.802 806.079 106.802 798.973 Q106.802 791.843 104.973 788.301 Q103.168 784.737 99.5335 784.737 M99.5335 781.033 Q105.344 781.033 108.399 785.639 Q111.478 790.223 111.478 798.973 Q111.478 807.7 108.399 812.306 Q105.344 816.889 99.5335 816.889 Q93.7234 816.889 90.6447 812.306 Q87.5892 807.7 87.5892 798.973 Q87.5892 790.223 90.6447 785.639 Q93.7234 781.033 99.5335 781.033 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M91.5706 533.407 L99.2095 533.407 L99.2095 507.041 L90.8993 508.708 L90.8993 504.449 L99.1632 502.782 L103.839 502.782 L103.839 533.407 L111.478 533.407 L111.478 537.342 L91.5706 537.342 L91.5706 533.407 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M95.1586 254.531 L111.478 254.531 L111.478 258.466 L89.5336 258.466 L89.5336 254.531 Q92.1956 251.776 96.7789 247.147 Q101.385 242.494 102.566 241.151 Q104.811 238.628 105.691 236.892 Q106.594 235.133 106.594 233.443 Q106.594 230.688 104.649 228.952 Q102.728 227.216 99.6261 227.216 Q97.4271 227.216 94.9734 227.98 Q92.5428 228.744 89.7651 230.295 L89.7651 225.573 Q92.5891 224.438 95.0428 223.86 Q97.4965 223.281 99.5335 223.281 Q104.904 223.281 108.098 225.966 Q111.293 228.651 111.293 233.142 Q111.293 235.272 110.483 237.193 Q109.696 239.091 107.589 241.684 Q107.01 242.355 103.909 245.572 Q100.807 248.767 95.1586 254.531 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip662)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,520.062 252.35,623.949 294.808,694.992 337.266,741.879 379.724,771.421 422.182,788.867 464.641,798.188 507.099,802.319 549.557,803.368 592.015,802.793 634.473,801.553 676.931,800.235 719.39,799.153 761.848,798.437 804.306,798.093 846.764,798.058 889.222,798.235 931.681,798.524 974.139,798.832 1016.6,799.092 1059.06,799.262 1101.51,799.326 1143.97,799.289 1186.43,799.176 1228.89,799.02 1271.35,798.859 1313.8,798.727 1356.26,798.652 1398.72,798.647 1441.18,798.714 1483.64,798.84 1526.1,799 1568.55,799.158 1611.01,799.279 1653.47,799.326 1695.93,799.276 1738.39,799.119 1780.84,798.868 1823.3,798.563 1865.76,798.267 1908.22,798.071 1950.68,798.074 1993.14,798.374 2035.59,799.043 2078.05,800.082 2120.51,801.384 2162.97,802.659 2205.43,803.361 2247.88,802.584 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,525.784 294.808,395.752 337.266,360.727 379.724,384.565 422.182,440.857 464.641,510.998 507.099,582.527 549.557,647.719 592.015,702.395 634.473,744.948 676.931,775.531 719.39,795.421 761.848,806.517 804.306,810.955 846.764,810.837 889.222,808.044 931.681,804.121 974.139,800.224 1016.6,797.118 1059.06,795.2 1101.51,794.559 1143.97,795.044 1186.43,796.342 1228.89,798.055 1271.35,799.774 1313.8,801.142 1356.26,801.899 1398.72,801.916 1441.18,801.205 1483.64,799.92 1526.1,798.324 1568.55,796.76 1611.01,795.592 1653.47,795.149 1695.93,795.661 1738.39,797.194 1780.84,799.607 1823.3,802.518 1865.76,805.302 1908.22,807.132 1950.68,807.068 1993.14,804.216 2035.59,797.962 2078.05,788.302 2120.51,776.287 2162.97,764.595 2205.43,758.25 2247.88,765.507 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,1234.47 294.808,1366.84 337.266,1317.09 379.724,1172.5 422.182,993.413 464.641,819.094 507.099,672.698 549.557,565.438 592.015,500.027 634.473,473.497 676.931,479.429 719.39,509.697 761.848,555.776 804.306,609.669 846.764,664.528 889.222,715.008 931.681,757.407 974.139,789.64 1016.6,811.089 1059.06,822.36 1101.51,824.991 1143.97,821.126 1186.43,813.201 1228.89,803.64 1271.35,794.605 1313.8,787.787 1356.26,784.271 1398.72,784.464 1441.18,788.101 1483.64,794.317 1526.1,801.79 1568.55,808.927 1611.01,814.106 1653.47,815.932 1695.93,813.497 1738.39,806.617 1780.84,796.016 1823.3,783.428 1865.76,771.564 1908.22,763.93 1950.68,764.421 1993.14,776.66 2035.59,803.035 2078.05,843.346 2120.51,893.042 2162.97,940.951 2205.43,966.449 2247.88,935.993 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#c271d2; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,234.944 294.808,87.9763 337.266,175.467 379.724,370.152 422.182,588.105 464.641,778.579 507.099,915.467 549.557,990.24 592.015,1006.18 634.473,973.802 676.931,907.246 719.39,821.624 761.848,731.079 804.306,647.523 846.764,579.9 889.222,533.897 931.681,511.994 974.139,513.787 1016.6,536.484 1059.06,575.524 1101.51,625.25 1143.97,679.58 1186.43,732.636 1228.89,779.295 1271.35,815.616 1313.8,839.154 1356.26,849.103 1398.72,846.307 1441.18,833.107 1483.64,813.048 1526.1,790.468 1568.55,769.98 1611.01,755.897 1653.47,751.626 1695.93,759.092 1738.39,778.243 1780.84,806.703 1823.3,839.64 1865.76,869.943 1908.22,888.784 1950.68,886.662 1993.14,855.044 2035.59,788.707 2078.05,688.894 2120.51,567.434 2162.97,451.938 2205.43,392.231 2247.88,468.157 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#ac8d18; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,1320.18 294.808,1445.72 337.266,1356.26 379.724,1174.78 422.182,979.7 464.641,815.961 507.099,704.258 549.557,648.578 592.015,642.251 634.473,672.689 676.931,724.977 719.39,784.476 761.848,838.584 804.306,877.8 846.764,896.208 889.222,891.508 931.681,864.696 974.139,819.502 1016.6,761.658 1059.06,698.091 1101.51,636.106 1143.97,582.601 1186.43,543.4 1228.89,522.702 1271.35,522.702 1313.8,543.4 1356.26,582.601 1398.72,636.106 1441.18,698.091 1483.64,761.658 1526.1,819.502 1568.55,864.696 1611.01,891.508 1653.47,896.208 1695.93,877.8 1738.39,838.584 1780.84,784.476 1823.3,724.977 1865.76,672.689 1908.22,642.251 1950.68,648.578 1993.14,704.258 2035.59,815.961 2078.05,979.7 2120.51,1174.78 2162.97,1356.26 2205.43,1445.72 2247.88,1320.18 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#00a9ad; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,468.157 294.808,392.231 337.266,451.938 379.724,567.434 422.182,688.894 464.641,788.707 507.099,855.044 549.557,886.662 592.015,888.784 634.473,869.943 676.931,839.64 719.39,806.703 761.848,778.243 804.306,759.092 846.764,751.626 889.222,755.897 931.681,769.98 974.139,790.468 1016.6,813.048 1059.06,833.107 1101.51,846.307 1143.97,849.103 1186.43,839.154 1228.89,815.616 1271.35,779.295 1313.8,732.636 1356.26,679.58 1398.72,625.25 1441.18,575.524 1483.64,536.484 1526.1,513.787 1568.55,511.994 1611.01,533.897 1653.47,579.9 1695.93,647.523 1738.39,731.079 1780.84,821.624 1823.3,907.246 1865.76,973.802 1908.22,1006.18 1950.68,990.24 1993.14,915.467 2035.59,778.579 2078.05,588.105 2120.51,370.152 2162.97,175.467 2205.43,87.9763 2247.88,234.944 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#ed5d92; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,935.993 294.808,966.449 337.266,940.951 379.724,893.042 422.182,843.346 464.641,803.035 507.099,776.66 549.557,764.421 592.015,763.93 634.473,771.564 676.931,783.428 719.39,796.016 761.848,806.617 804.306,813.497 846.764,815.932 889.222,814.106 931.681,808.927 974.139,801.79 1016.6,794.317 1059.06,788.101 1101.51,784.464 1143.97,784.271 1186.43,787.787 1228.89,794.605 1271.35,803.64 1313.8,813.201 1356.26,821.126 1398.72,824.991 1441.18,822.36 1483.64,811.089 1526.1,789.64 1568.55,757.407 1611.01,715.008 1653.47,664.528 1695.93,609.669 1738.39,555.776 1780.84,509.697 1823.3,479.429 1865.76,473.497 1908.22,500.027 1950.68,565.438 1993.14,672.698 2035.59,819.094 2078.05,993.413 2120.51,1172.5 2162.97,1317.09 2205.43,1366.84 2247.88,1234.47 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#c68125; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,765.507 294.808,758.25 337.266,764.595 379.724,776.287 422.182,788.302 464.641,797.962 507.099,804.216 549.557,807.068 592.015,807.132 634.473,805.302 676.931,802.518 719.39,799.607 761.848,797.194 804.306,795.661 846.764,795.149 889.222,795.592 931.681,796.76 974.139,798.324 1016.6,799.92 1059.06,801.205 1101.51,801.916 1143.97,801.899 1186.43,801.142 1228.89,799.774 1271.35,798.055 1313.8,796.342 1356.26,795.044 1398.72,794.559 1441.18,795.2 1483.64,797.118 1526.1,800.224 1568.55,804.121 1611.01,808.044 1653.47,810.837 1695.93,810.955 1738.39,806.517 1780.84,795.421 1823.3,775.531 1865.76,744.948 1908.22,702.395 1950.68,647.719 1993.14,582.527 2035.59,510.998 2078.05,440.857 2120.51,384.565 2162.97,360.727 2205.43,395.752 2247.88,525.784 2290.34,798.938 "/>
<polyline clip-path="url(#clip662)" style="stroke:#00a98d; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="209.891,798.938 252.35,802.584 294.808,803.361 337.266,802.659 379.724,801.384 422.182,800.082 464.641,799.043 507.099,798.374 549.557,798.074 592.015,798.071 634.473,798.267 676.931,798.563 719.39,798.868 761.848,799.119 804.306,799.276 846.764,799.326 889.222,799.279 931.681,799.158 974.139,799 1016.6,798.84 1059.06,798.714 1101.51,798.647 1143.97,798.652 1186.43,798.727 1228.89,798.859 1271.35,799.02 1313.8,799.176 1356.26,799.289 1398.72,799.326 1441.18,799.262 1483.64,799.092 1526.1,798.832 1568.55,798.524 1611.01,798.235 1653.47,798.058 1695.93,798.093 1738.39,798.437 1780.84,799.153 1823.3,800.235 1865.76,801.553 1908.22,802.793 1950.68,803.368 1993.14,802.319 2035.59,798.188 2078.05,788.867 2120.51,771.421 2162.97,741.879 2205.43,694.992 2247.88,623.949 2290.34,520.062 "/>
<circle clip-path="url(#clip662)" cx="209.891" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="469.948" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="730.004" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="990.061" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="1250.12" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="1510.17" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="1770.23" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="2030.29" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<circle clip-path="url(#clip662)" cx="2290.34" cy="520.062" r="14.4" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.2"/>
<path clip-path="url(#clip660)" d="M1974.9 665.458 L2279.25 665.458 L2279.25 95.2176 L1974.9 95.2176  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip660)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1974.9,665.458 2279.25,665.458 2279.25,95.2176 1974.9,95.2176 1974.9,665.458 "/>
<polyline clip-path="url(#clip660)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,147.058 2146.42,147.058 "/>
<path clip-path="url(#clip660)" d="M2184.77 166.745 Q2182.96 171.375 2181.25 172.787 Q2179.54 174.199 2176.67 174.199 L2173.26 174.199 L2173.26 170.634 L2175.76 170.634 Q2177.52 170.634 2178.49 169.8 Q2179.47 168.967 2180.65 165.865 L2181.41 163.921 L2170.92 138.412 L2175.44 138.412 L2183.54 158.689 L2191.64 138.412 L2196.16 138.412 L2184.77 166.745 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2203.45 160.402 L2211.09 160.402 L2211.09 134.037 L2202.78 135.703 L2202.78 131.444 L2211.04 129.778 L2215.72 129.778 L2215.72 160.402 L2223.35 160.402 L2223.35 164.338 L2203.45 164.338 L2203.45 160.402 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,198.898 2146.42,198.898 "/>
<path clip-path="url(#clip660)" d="M2184.77 218.585 Q2182.96 223.215 2181.25 224.627 Q2179.54 226.039 2176.67 226.039 L2173.26 226.039 L2173.26 222.474 L2175.76 222.474 Q2177.52 222.474 2178.49 221.64 Q2179.47 220.807 2180.65 217.705 L2181.41 215.761 L2170.92 190.252 L2175.44 190.252 L2183.54 210.529 L2191.64 190.252 L2196.16 190.252 L2184.77 218.585 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2206.67 212.242 L2222.98 212.242 L2222.98 216.178 L2201.04 216.178 L2201.04 212.242 Q2203.7 209.488 2208.29 204.858 Q2212.89 200.205 2214.07 198.863 Q2216.32 196.34 2217.2 194.604 Q2218.1 192.844 2218.1 191.155 Q2218.1 188.4 2216.16 186.664 Q2214.23 184.928 2211.13 184.928 Q2208.93 184.928 2206.48 185.692 Q2204.05 186.455 2201.27 188.006 L2201.27 183.284 Q2204.1 182.15 2206.55 181.571 Q2209 180.993 2211.04 180.993 Q2216.41 180.993 2219.6 183.678 Q2222.8 186.363 2222.8 190.854 Q2222.8 192.983 2221.99 194.905 Q2221.2 196.803 2219.1 199.395 Q2218.52 200.067 2215.42 203.284 Q2212.31 206.479 2206.67 212.242 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,250.738 2146.42,250.738 "/>
<path clip-path="url(#clip660)" d="M2184.77 270.425 Q2182.96 275.055 2181.25 276.467 Q2179.54 277.879 2176.67 277.879 L2173.26 277.879 L2173.26 274.314 L2175.76 274.314 Q2177.52 274.314 2178.49 273.48 Q2179.47 272.647 2180.65 269.545 L2181.41 267.601 L2170.92 242.092 L2175.44 242.092 L2183.54 262.369 L2191.64 242.092 L2196.16 242.092 L2184.77 270.425 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2216.8 249.383 Q2220.16 250.101 2222.04 252.369 Q2223.93 254.638 2223.93 257.971 Q2223.93 263.087 2220.42 265.888 Q2216.9 268.689 2210.42 268.689 Q2208.24 268.689 2205.92 268.249 Q2203.63 267.832 2201.18 266.976 L2201.18 262.462 Q2203.12 263.596 2205.44 264.175 Q2207.75 264.754 2210.28 264.754 Q2214.67 264.754 2216.97 263.018 Q2219.28 261.281 2219.28 257.971 Q2219.28 254.916 2217.13 253.203 Q2215 251.467 2211.18 251.467 L2207.15 251.467 L2207.15 247.624 L2211.36 247.624 Q2214.81 247.624 2216.64 246.258 Q2218.47 244.87 2218.47 242.277 Q2218.47 239.615 2216.57 238.203 Q2214.7 236.768 2211.18 236.768 Q2209.26 236.768 2207.06 237.184 Q2204.86 237.601 2202.22 238.481 L2202.22 234.314 Q2204.88 233.573 2207.2 233.203 Q2209.54 232.833 2211.6 232.833 Q2216.92 232.833 2220.02 235.263 Q2223.12 237.67 2223.12 241.791 Q2223.12 244.661 2221.48 246.652 Q2219.84 248.62 2216.8 249.383 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#c271d2; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,302.578 2146.42,302.578 "/>
<path clip-path="url(#clip660)" d="M2184.77 322.265 Q2182.96 326.895 2181.25 328.307 Q2179.54 329.719 2176.67 329.719 L2173.26 329.719 L2173.26 326.154 L2175.76 326.154 Q2177.52 326.154 2178.49 325.32 Q2179.47 324.487 2180.65 321.385 L2181.41 319.441 L2170.92 293.932 L2175.44 293.932 L2183.54 314.209 L2191.64 293.932 L2196.16 293.932 L2184.77 322.265 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2215.48 289.372 L2203.68 307.821 L2215.48 307.821 L2215.48 289.372 M2214.26 285.298 L2220.14 285.298 L2220.14 307.821 L2225.07 307.821 L2225.07 311.709 L2220.14 311.709 L2220.14 319.858 L2215.48 319.858 L2215.48 311.709 L2199.88 311.709 L2199.88 307.196 L2214.26 285.298 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#ac8d18; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,354.418 2146.42,354.418 "/>
<path clip-path="url(#clip660)" d="M2184.77 374.105 Q2182.96 378.735 2181.25 380.147 Q2179.54 381.559 2176.67 381.559 L2173.26 381.559 L2173.26 377.994 L2175.76 377.994 Q2177.52 377.994 2178.49 377.16 Q2179.47 376.327 2180.65 373.225 L2181.41 371.281 L2170.92 345.772 L2175.44 345.772 L2183.54 366.049 L2191.64 345.772 L2196.16 345.772 L2184.77 374.105 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2202.68 337.138 L2221.04 337.138 L2221.04 341.073 L2206.97 341.073 L2206.97 349.545 Q2207.98 349.198 2209 349.036 Q2210.02 348.85 2211.04 348.85 Q2216.83 348.85 2220.21 352.022 Q2223.59 355.193 2223.59 360.61 Q2223.59 366.188 2220.11 369.29 Q2216.64 372.369 2210.32 372.369 Q2208.15 372.369 2205.88 371.998 Q2203.63 371.628 2201.23 370.887 L2201.23 366.188 Q2203.31 367.323 2205.53 367.878 Q2207.75 368.434 2210.23 368.434 Q2214.23 368.434 2216.57 366.327 Q2218.91 364.221 2218.91 360.61 Q2218.91 356.999 2216.57 354.892 Q2214.23 352.786 2210.23 352.786 Q2208.35 352.786 2206.48 353.202 Q2204.63 353.619 2202.68 354.499 L2202.68 337.138 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#00a9ad; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,406.258 2146.42,406.258 "/>
<path clip-path="url(#clip660)" d="M2184.77 425.945 Q2182.96 430.575 2181.25 431.987 Q2179.54 433.399 2176.67 433.399 L2173.26 433.399 L2173.26 429.834 L2175.76 429.834 Q2177.52 429.834 2178.49 429 Q2179.47 428.167 2180.65 425.065 L2181.41 423.121 L2170.92 397.612 L2175.44 397.612 L2183.54 417.889 L2191.64 397.612 L2196.16 397.612 L2184.77 425.945 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2213.22 404.394 Q2210.07 404.394 2208.22 406.547 Q2206.39 408.7 2206.39 412.45 Q2206.39 416.176 2208.22 418.352 Q2210.07 420.505 2213.22 420.505 Q2216.36 420.505 2218.19 418.352 Q2220.04 416.176 2220.04 412.45 Q2220.04 408.7 2218.19 406.547 Q2216.36 404.394 2213.22 404.394 M2222.5 389.741 L2222.5 394.001 Q2220.74 393.167 2218.93 392.728 Q2217.15 392.288 2215.39 392.288 Q2210.76 392.288 2208.31 395.413 Q2205.88 398.538 2205.53 404.857 Q2206.9 402.843 2208.96 401.778 Q2211.02 400.69 2213.49 400.69 Q2218.7 400.69 2221.71 403.862 Q2224.74 407.01 2224.74 412.45 Q2224.74 417.774 2221.6 420.991 Q2218.45 424.209 2213.22 424.209 Q2207.22 424.209 2204.05 419.626 Q2200.88 415.019 2200.88 406.292 Q2200.88 398.098 2204.77 393.237 Q2208.66 388.353 2215.21 388.353 Q2216.97 388.353 2218.75 388.7 Q2220.55 389.047 2222.5 389.741 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#ed5d92; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,458.098 2146.42,458.098 "/>
<path clip-path="url(#clip660)" d="M2184.77 477.785 Q2182.96 482.415 2181.25 483.827 Q2179.54 485.239 2176.67 485.239 L2173.26 485.239 L2173.26 481.674 L2175.76 481.674 Q2177.52 481.674 2178.49 480.84 Q2179.47 480.007 2180.65 476.905 L2181.41 474.961 L2170.92 449.452 L2175.44 449.452 L2183.54 469.729 L2191.64 449.452 L2196.16 449.452 L2184.77 477.785 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2201.46 440.818 L2223.68 440.818 L2223.68 442.808 L2211.13 475.378 L2206.25 475.378 L2218.05 444.753 L2201.46 444.753 L2201.46 440.818 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#c68125; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,509.938 2146.42,509.938 "/>
<path clip-path="url(#clip660)" d="M2184.77 529.625 Q2182.96 534.255 2181.25 535.667 Q2179.54 537.079 2176.67 537.079 L2173.26 537.079 L2173.26 533.514 L2175.76 533.514 Q2177.52 533.514 2178.49 532.68 Q2179.47 531.847 2180.65 528.745 L2181.41 526.801 L2170.92 501.292 L2175.44 501.292 L2183.54 521.569 L2191.64 501.292 L2196.16 501.292 L2184.77 529.625 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2212.64 510.806 Q2209.3 510.806 2207.38 512.588 Q2205.48 514.37 2205.48 517.495 Q2205.48 520.62 2207.38 522.403 Q2209.3 524.185 2212.64 524.185 Q2215.97 524.185 2217.89 522.403 Q2219.81 520.597 2219.81 517.495 Q2219.81 514.37 2217.89 512.588 Q2215.99 510.806 2212.64 510.806 M2207.96 508.815 Q2204.95 508.074 2203.26 506.014 Q2201.6 503.954 2201.6 500.991 Q2201.6 496.847 2204.54 494.44 Q2207.5 492.033 2212.64 492.033 Q2217.8 492.033 2220.74 494.44 Q2223.68 496.847 2223.68 500.991 Q2223.68 503.954 2221.99 506.014 Q2220.32 508.074 2217.34 508.815 Q2220.72 509.602 2222.59 511.894 Q2224.49 514.185 2224.49 517.495 Q2224.49 522.519 2221.41 525.204 Q2218.35 527.889 2212.64 527.889 Q2206.92 527.889 2203.84 525.204 Q2200.79 522.519 2200.79 517.495 Q2200.79 514.185 2202.68 511.894 Q2204.58 509.602 2207.96 508.815 M2206.25 501.431 Q2206.25 504.116 2207.92 505.62 Q2209.6 507.125 2212.64 507.125 Q2215.65 507.125 2217.34 505.62 Q2219.05 504.116 2219.05 501.431 Q2219.05 498.745 2217.34 497.241 Q2215.65 495.736 2212.64 495.736 Q2209.6 495.736 2207.92 497.241 Q2206.25 498.745 2206.25 501.431 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip660)" style="stroke:#00a98d; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="1999.4,561.778 2146.42,561.778 "/>
<path clip-path="url(#clip660)" d="M2184.77 581.465 Q2182.96 586.095 2181.25 587.507 Q2179.54 588.919 2176.67 588.919 L2173.26 588.919 L2173.26 585.354 L2175.76 585.354 Q2177.52 585.354 2178.49 584.52 Q2179.47 583.687 2180.65 580.585 L2181.41 578.641 L2170.92 553.132 L2175.44 553.132 L2183.54 573.409 L2191.64 553.132 L2196.16 553.132 L2184.77 581.465 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2202.78 578.34 L2202.78 574.081 Q2204.54 574.914 2206.34 575.354 Q2208.15 575.794 2209.88 575.794 Q2214.51 575.794 2216.94 572.692 Q2219.4 569.567 2219.74 563.224 Q2218.4 565.215 2216.34 566.28 Q2214.28 567.345 2211.78 567.345 Q2206.6 567.345 2203.56 564.22 Q2200.55 561.072 2200.55 555.632 Q2200.55 550.308 2203.7 547.09 Q2206.85 543.873 2212.08 543.873 Q2218.08 543.873 2221.23 548.479 Q2224.4 553.062 2224.4 561.812 Q2224.4 569.984 2220.51 574.868 Q2216.64 579.729 2210.09 579.729 Q2208.33 579.729 2206.53 579.382 Q2204.72 579.034 2202.78 578.34 M2212.08 563.687 Q2215.23 563.687 2217.06 561.534 Q2218.91 559.382 2218.91 555.632 Q2218.91 551.905 2217.06 549.752 Q2215.23 547.576 2212.08 547.576 Q2208.93 547.576 2207.08 549.752 Q2205.25 551.905 2205.25 555.632 Q2205.25 559.382 2207.08 561.534 Q2208.93 563.687 2212.08 563.687 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><circle clip-path="url(#clip660)" cx="2072.91" cy="613.618" r="20.48" fill="#8e971d" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="4.55111"/>
<path clip-path="url(#clip660)" d="M2184.77 633.305 Q2182.96 637.935 2181.25 639.347 Q2179.54 640.759 2176.67 640.759 L2173.26 640.759 L2173.26 637.194 L2175.76 637.194 Q2177.52 637.194 2178.49 636.36 Q2179.47 635.527 2180.65 632.425 L2181.41 630.481 L2170.92 604.972 L2175.44 604.972 L2183.54 625.249 L2191.64 604.972 L2196.16 604.972 L2184.77 633.305 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2203.45 626.962 L2211.09 626.962 L2211.09 600.597 L2202.78 602.263 L2202.78 598.004 L2211.04 596.338 L2215.72 596.338 L2215.72 626.962 L2223.35 626.962 L2223.35 630.898 L2203.45 630.898 L2203.45 626.962 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip660)" d="M2242.8 599.416 Q2239.19 599.416 2237.36 602.981 Q2235.55 606.523 2235.55 613.652 Q2235.55 620.759 2237.36 624.324 Q2239.19 627.865 2242.8 627.865 Q2246.43 627.865 2248.24 624.324 Q2250.07 620.759 2250.07 613.652 Q2250.07 606.523 2248.24 602.981 Q2246.43 599.416 2242.8 599.416 M2242.8 595.713 Q2248.61 595.713 2251.66 600.319 Q2254.74 604.902 2254.74 613.652 Q2254.74 622.379 2251.66 626.986 Q2248.61 631.569 2242.8 631.569 Q2236.99 631.569 2233.91 626.986 Q2230.85 622.379 2230.85 613.652 Q2230.85 604.902 2233.91 600.319 Q2236.99 595.713 2242.8 595.713 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /></svg>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">FastGaussQuadrature</span>
<span class="n">xn</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gausslobatto</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander_legendre</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span>
<span class="n">Pn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pxx</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">V</span>
<span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">Pn</span><span class="p">)</span>
<span class="n">scatter!</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="o">.</span><span class="p">(</span><span class="n">xn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>ArgumentError: Package FastGaussQuadrature not found in current path.
- Run `import Pkg; Pkg.add(&quot;FastGaussQuadrature&quot;)` to install the FastGaussQuadrature package.

Stacktrace:
 [1] macro expansion
   @ ./loading.jl:1630 [inlined]
 [2] macro expansion
   @ ./lock.jl:267 [inlined]
 [3] require(into::Module, mod::Symbol)
   @ Base ./loading.jl:1611
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">vander_legendre_deriv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="nb">nothing</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">isnothing</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">        </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="c"># Square by default</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">    </span><span class="n">dQ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">    </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>
<span class="w">    </span><span class="n">dQ</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span>
<span class="w">        </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="n">dQ</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Q</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dQ</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="n">n</span><span class="p">]</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">dQ</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>vander_legendre_deriv (generic function with 2 methods)
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="galerkin-method-l-2-projection">
<h1>Galerkin method: <span class="math notranslate nohighlight">\(L^2\)</span> projection<a class="headerlink" href="#galerkin-method-l-2-projection" title="Permalink to this heading">#</a></h1>
<p>A nice test problem that doesn’t require derivatives or boundary conditions:
Find <span class="math notranslate nohighlight">\(u \in \mathcal V_h\)</span> such that
<div class="math notranslate nohighlight">
\[ \int_{-1}^1 v(x) \big[ u(x) - f(x) \big] = 0, \quad \forall v \in \mathcal V_h\]</div>
</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">febasis</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gausslobatto</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="w">    </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gausslegendre</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
<span class="w">    </span><span class="n">Pk</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander_legendre_deriv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="n">Bp</span><span class="p">,</span><span class="w"> </span><span class="n">Dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vander_legendre_deriv</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bp</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Pk</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dp</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Pk</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">D</span>
<span class="k">end</span>

<span class="k">function</span><span class="w"> </span><span class="n">L2_galerkin</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">febasis</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span>
<span class="w">    </span><span class="n">rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">\</span><span class="w"> </span><span class="n">rhs</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>L2_galerkin (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tanh</span><span class="p">(</span><span class="mi">5</span><span class="n">x</span><span class="p">)</span>
<span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span>
<span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L2_galerkin</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="ss">:bottomright</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Galerkin error: </span><span class="si">$</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/af42b250713b95fce9f06fb3de3f9c749a9e7206be519bb11acad6e4b46ccf54.svg" src="../_images/af42b250713b95fce9f06fb3de3f9c749a9e7206be519bb11acad6e4b46ccf54.svg" /></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="embed-the-solution-in-the-continuous-space">
<h1>Embed the solution in the continuous space<a class="headerlink" href="#embed-the-solution-in-the-continuous-space" title="Permalink to this heading">#</a></h1>
<p>In thel last figure, the Galerkin solution was represented by a piecewise linear function, emphasizing its nodal values. Let’s make a nicer plot by multiplying by the corresponding nodal basis function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span>
<span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L2_galerkin</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">BB</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">febasis</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;exact&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Galerkin error: </span><span class="si">$</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">error</span><span class="p">))</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="ss">:bottomright</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">BB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Galerkin solution&quot;</span><span class="p">)</span>
<span class="n">scatter!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Nodal values&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fbc5ac3ebe1041e9b111ceb02a91a9b0c6cf83d9a73e5614b0525ab32cb7a95a.svg" src="../_images/fbc5ac3ebe1041e9b111ceb02a91a9b0c6cf83d9a73e5614b0525ab32cb7a95a.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">.^</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">:</span><span class="mi">8</span><span class="p">)</span>
<span class="k">function</span><span class="w"> </span><span class="n">L2_error</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L2_galerkin</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<span class="w">    </span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">end</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">L2_error</span><span class="o">.</span><span class="p">(</span><span class="n">ns</span><span class="p">),</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">yscale</span><span class="o">=</span><span class="ss">:log10</span><span class="p">,</span>
<span class="w">  </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Convergence&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlabel</span><span class="o">=</span><span class="s">&quot;number of points&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylabel</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c1b302079c5dd3b719754d332080a6b0ad3aabafc6f4c7cfb9815ac0fe2f7931.svg" src="../_images/c1b302079c5dd3b719754d332080a6b0ad3aabafc6f4c7cfb9815ac0fe2f7931.svg" /></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="galerkin-error-estimates">
<h1>Galerkin error estimates<a class="headerlink" href="#galerkin-error-estimates" title="Permalink to this heading">#</a></h1>
<p>We introduce the notation
<div class="math notranslate nohighlight">
\[ a(v, u) = \int_\Omega \nabla v(x) \cdot \nabla u(x) \]</div>

and note that <span class="math notranslate nohighlight">\(a\)</span> is</p>
<ul class="simple">
<li><p>bilinear (linear in each of its arguments)</p></li>
<li><p>symmetric: <span class="math notranslate nohighlight">\(a(u, v) = a(v,u)\)</span></p></li>
<li><p>positive definite: <span class="math notranslate nohighlight">\(a(u, u) &gt; 0\)</span> when <span class="math notranslate nohighlight">\(u \ne 0\)</span>
thus defines an inner product on the function space <span class="math notranslate nohighlight">\(V\)</span>.</p></li>
</ul>
<p>We also introduce the <span class="math notranslate nohighlight">\(L^2\)</span> inner product
<div class="math notranslate nohighlight">
\[ \langle u, v \rangle = \int_\Omega u(x) v(x) \]</div>

so that our continuous weak form is to find <span class="math notranslate nohighlight">\(u \in V\)</span> such that
<div class="math notranslate nohighlight">
\[ a(v, u) = \langle v, f \rangle, \quad \forall v\in V. \]</div>

Our Galerkin discretization is to find <span class="math notranslate nohighlight">\(u_h \in V_h \subset V\)</span> such that
<div class="math notranslate nohighlight">
\[ a(v_h, u_h) = \langle v_h, f \rangle, \quad \forall v_h \in V_h . \]</div>

Since <span class="math notranslate nohighlight">\(V_h \subset V\)</span>, we can subtract these two, yielding
<div class="math notranslate nohighlight">
\[ a(v_h, u_h - u) = 0, \quad \forall v_h \in V_h .\]</div>

This says that the error in the discrete solution <span class="math notranslate nohighlight">\(u_h - u\)</span> is <span class="math notranslate nohighlight">\(a\)</span>-orthogonal to all test functions <span class="math notranslate nohighlight">\(v_h\)</span>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="galerkin-optimality-via-energy-norms">
<h1>Galerkin optimality via energy norms<a class="headerlink" href="#galerkin-optimality-via-energy-norms" title="Permalink to this heading">#</a></h1>
<p>We can also define the “energy norm” or <span class="math notranslate nohighlight">\(a\)</span>-norm,
<div class="math notranslate nohighlight">
\[ \lVert u \rVert_a = \sqrt{a(u,u)} . \]</div>

This norm satisfies the Cauchy-Schwarz inequality,
<div class="math notranslate nohighlight">
\[ \lvert a(u,v) \rvert \le \lVert u \rVert_a \lVert v \rVert_a . \]</div>

Now,</p>
<div class="amsmath math notranslate nohighlight" id="equation-774d2b40-37a1-4d98-8998-fdef8892bd78">
<span class="eqno">(49)<a class="headerlink" href="#equation-774d2b40-37a1-4d98-8998-fdef8892bd78" title="Permalink to this equation">#</a></span>\[\begin{align}
\lVert u_h - u \rVert_a^2 &amp;= a(u_h - u, u_h - u) \\
&amp;= a(u_h - v_h, u_h - u) + a(v_h - u, u_h - u) \\
&amp;= a(v_h - u, u_h - u) \\
&amp;\le \lVert v_h - u \rVert_a \lVert u_h - u \rVert_a .
\end{align}\]</div>
<p>In other words,
<div class="math notranslate nohighlight">
\[\lVert u_h - u \rVert_a \le \lVert v_h - u \rVert_a, \quad \forall v_h \in V_h .\]</div>

So the solution <span class="math notranslate nohighlight">\(u_h\)</span> computed by the Galerkin discretization is optimal over the subspace <span class="math notranslate nohighlight">\(V_h\)</span> as measured in the <span class="math notranslate nohighlight">\(a\)</span>-norm.</p>
<section id="observations">
<h2>Observations<a class="headerlink" href="#observations" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The Galerkin method computes the exact solution any time it resides in the subspace <span class="math notranslate nohighlight">\(V_h\)</span>.</p></li>
<li><p>The Galerkin method is automatically symmetric any time the weak form is symmetric.</p></li>
<li><p>The Galerkin method can be spectrally accurate, similar to the Chebyshev finite difference methods.</p></li>
<li><p>For a nonlinear problem, discretization and differentiation will commute.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="galerkin-method-for-poisson">
<h1>Galerkin method for Poisson<a class="headerlink" href="#galerkin-method-for-poisson" title="Permalink to this heading">#</a></h1>
<div class="math notranslate nohighlight">
\[ \int_{\Omega} \nabla v \cdot \kappa \cdot \nabla u = \int_{\Omega} v f, \forall v\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">poisson_galerkin</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">kappa</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">febasis</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">kappa</span><span class="o">.</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">D</span>
<span class="w">    </span><span class="n">rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="w">    </span><span class="c"># Boundary conditions</span>
<span class="w">    </span><span class="n">rhs</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="c">#A[end, :] .= 0</span>
<span class="w">    </span><span class="c">#A[end, end] = 1</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">\</span><span class="w"> </span><span class="n">rhs</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>poisson_galerkin (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">kappa</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.6</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="mf">0.55</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sin</span><span class="o">.</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">40</span>
<span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poisson_galerkin</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<span class="n">uexact</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="nb">pi</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>
<span class="n">plot</span><span class="p">(</span><span class="n">uexact</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Error: </span><span class="si">$</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">uexact</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">BB</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">febasis</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">BB</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;FE solution&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="n">scatter!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Nodal solution&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:circle</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="ss">:black</span><span class="p">,</span>
<span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="ss">:bottomright</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0d35a11ab18ff4febdcc7014282c70035b150d5da881f23ada7d7a7e12eb8338.svg" src="../_images/0d35a11ab18ff4febdcc7014282c70035b150d5da881f23ada7d7a7e12eb8338.svg" /></div>
</div>
<section id="what-if-we-only-impose-the-boundary-condition-on-one-side">
<h2>What if we only impose the boundary condition on one side?<a class="headerlink" href="#what-if-we-only-impose-the-boundary-condition-on-one-side" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="galerkin-preserves-symmetry">
<h1>Galerkin preserves symmetry<a class="headerlink" href="#galerkin-preserves-symmetry" title="Permalink to this heading">#</a></h1>
<p>The bilinear operator is symmetric if <span class="math notranslate nohighlight">\(a(v,u) = a(u,v)\)</span>,</p>
<div class="math notranslate nohighlight">
\[ a(v,u) = \int_{\Omega} \nabla v \cdot \kappa \cdot \nabla u \]</div>
<p>This is symmetric even for</p>
<ul class="simple">
<li><p>variable coefficients</p></li>
<li><p>any Neumann-type boundary conditions</p></li>
<li><p>Dirichlet if eliminated or lifted symmetrically</p></li>
<li><p>arbitrary grid spacing (and mesh topology in multiple dimensions)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">febasis</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span>
<span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">D</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">kappa</span><span class="o">.</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">D</span>
<span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span>
<span class="nd">@show</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">A</span><span class="o">&#39;</span><span class="p">)</span>
<span class="n">eigvals</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>norm(A - A&#39;) = 6.869198314985155e-16
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7-element Vector{Float64}:
 -1.2257316920942458e-15
  0.13096345516272143
  1.2722189926037417
  3.081972164593637
  6.840904696876489
 10.748215512493235
 14.885725178270272
</pre></div>
</div>
</div>
</div>
<section id="what-if-we-use-too-few-quadrature-points">
<h2>What if we use too few quadrature points?<a class="headerlink" href="#what-if-we-use-too-few-quadrature-points" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="../_images/libCEED-2-trim.svg" /></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="general-form">
<h1>General form<a class="headerlink" href="#general-form" title="Permalink to this heading">#</a></h1>
<div class="math notranslate nohighlight">
\[ \int_\Omega v\cdot f_0(u, \nabla u) + \nabla v\cdot f_1(u, \nabla u) = 0, \quad \forall v\]</div>
<p>we discretize as
<div class="math notranslate nohighlight">
\[ \sum_e \mathcal E_e^T \Big( B^T W \left\lvert \frac{\partial x}{\partial X} \right\rvert f_0(\tilde u, \nabla \tilde u) + D^T \left(\frac{\partial X}{\partial x}\right)^{T} W \left\lvert \frac{\partial x}{\partial X} \right\rvert f_1(\tilde u, \nabla\tilde u) \Big) = 0 \]</div>

where <span class="math notranslate nohighlight">\(\tilde u = B \mathcal E_e u\)</span> and <span class="math notranslate nohighlight">\(\nabla \tilde u = \frac{\partial X}{\partial x} D \mathcal E_e u\)</span> are the values and gradients evaluated at quadrature points.</p>
<section id="isoparametric-mapping">
<h2>Isoparametric mapping<a class="headerlink" href="#isoparametric-mapping" title="Permalink to this heading">#</a></h2>
<p>Given the reference coordinates <span class="math notranslate nohighlight">\(X \in \hat K \subset R^n\)</span> and physical coordinates <span class="math notranslate nohighlight">\(x(X)\)</span>, an integral on the physical element can be written
<div class="math notranslate nohighlight">
\[ \int_{K = x(\hat K)} f(x) dx = \int_K \underbrace{\left\lvert \frac{\partial x}{\partial X} \right\rvert}_{\text{determinant}} f(x(X)) dX .\]</div>
</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Notation</p></th>
<th class="head text-left"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(x\)</span></p></td>
<td class="text-left"><p>physical coordinates</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(X\)</span></p></td>
<td class="text-left"><p>reference coordinates</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\mathcal E_e\)</span></p></td>
<td class="text-left"><p>restriction from global vector to element <span class="math notranslate nohighlight">\(e\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(B\)</span></p></td>
<td class="text-left"><p>values of nodal basis functions at quadrature ponits on reference element</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(D\)</span></p></td>
<td class="text-left"><p>gradients of nodal basis functions at quadrature points on reference element</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(W\)</span></p></td>
<td class="text-left"><p>diagonal matrix of quadrature weights on reference element</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\frac{\partial x}{\partial X} = D \mathcal E_e x \)</span></p></td>
<td class="text-left"><p>gradient of physical coordinates with respect to reference coordinates</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\left\lvert \frac{\partial x}{\partial X}\right\rvert\)</span></p></td>
<td class="text-left"><p>determinant of coordinate transformation at each quadrature point</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\frac{\partial X}{\partial x} = \left(\frac{\partial x}{\partial X}\right)^{-1}\)</span></p></td>
<td class="text-left"><p>derivative of reference coordinates with respect to physical coordinates</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="finite-element-mesh-and-restriction">
<h1>Finite element mesh and restriction<a class="headerlink" href="#finite-element-mesh-and-restriction" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">fe1_mesh</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="p">)</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">LinRange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int</span><span class="p">[]</span>
<span class="w">    </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int</span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">nelem</span>
<span class="w">        </span><span class="n">append!</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">P</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="o">*</span><span class="n">P</span><span class="p">)</span>
<span class="w">        </span><span class="n">append!</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">P</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">sparse</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">nelem</span><span class="o">*</span><span class="n">P</span><span class="p">))</span>
<span class="k">end</span>
<span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span>
<span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe1_mesh</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(LinRange{Float64}(-1.0, 1.0, 4), sparse([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12], [1, 2, 3, 4, 4, 5, 6, 7, 7, 8, 9, 10], [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0], 12, 10))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">xnodal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span>
<span class="w">    </span><span class="n">xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Float64</span><span class="p">[]</span>
<span class="w">    </span><span class="n">xref</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gausslobatto</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">nelem</span>
<span class="w">        </span><span class="n">xL</span><span class="p">,</span><span class="w"> </span><span class="n">xR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="w">        </span><span class="n">append!</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">xL</span><span class="o">+</span><span class="n">xR</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="p">(</span><span class="n">xR</span><span class="o">-</span><span class="n">xL</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xref</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">xn</span>
<span class="k">end</span>
<span class="n">xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xnodal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="n">scatter</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:square</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7cdd630d1d1e7df3adc2ea0c0344ca8f1de5376db3de8f79e3f1d4b455618148.svg" src="../_images/7cdd630d1d1e7df3adc2ea0c0344ca8f1de5376db3de8f79e3f1d4b455618148.svg" /></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="finite-element-building-blocks">
<h1>Finite element building blocks<a class="headerlink" href="#finite-element-building-blocks" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="kt">FESpace</span>
<span class="w">    </span><span class="n">P</span><span class="o">::</span><span class="kt">Int</span>
<span class="w">    </span><span class="n">Q</span><span class="o">::</span><span class="kt">Int</span>
<span class="w">    </span><span class="n">nelem</span><span class="o">::</span><span class="kt">Int</span>
<span class="w">    </span><span class="n">x</span><span class="o">::</span><span class="kt">Vector</span>
<span class="w">    </span><span class="n">xn</span><span class="o">::</span><span class="kt">Vector</span>
<span class="w">    </span><span class="n">Et</span><span class="o">::</span><span class="kt">SparseMatrixCSC</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span><span class="w"> </span><span class="kt">Int64</span><span class="p">}</span>
<span class="w">    </span><span class="n">q</span><span class="o">::</span><span class="kt">Vector</span>
<span class="w">    </span><span class="n">w</span><span class="o">::</span><span class="kt">Vector</span>
<span class="w">    </span><span class="n">B</span><span class="o">::</span><span class="kt">Matrix</span>
<span class="w">    </span><span class="n">D</span><span class="o">::</span><span class="kt">Matrix</span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span><span class="n">FESpace</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="p">)</span>
<span class="w">        </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">Et</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe1_mesh</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="p">)</span>
<span class="w">        </span><span class="nd">@show</span><span class="w"> </span><span class="n">Et</span>
<span class="w">        </span><span class="n">xn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xnodal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span>
<span class="w">        </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">febasis</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">)</span>
<span class="w">        </span><span class="n">new</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">nelem</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">xn</span><span class="p">,</span><span class="w"> </span><span class="n">Et</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c"># Extract out what we need for element e</span>
<span class="k">function</span><span class="w"> </span><span class="n">fe_element</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="n">xL</span><span class="p">,</span><span class="w"> </span><span class="n">xR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">e</span><span class="o">:</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xL</span><span class="o">+</span><span class="n">xR</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="p">(</span><span class="n">xR</span><span class="o">-</span><span class="n">xL</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">fe</span><span class="o">.</span><span class="n">q</span>
<span class="w">    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">xR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xL</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">w</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">Et</span><span class="p">[(</span><span class="n">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fe</span><span class="o">.</span><span class="n">P</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="n">e</span><span class="o">*</span><span class="n">fe</span><span class="o">.</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span>
<span class="w">    </span><span class="n">dXdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">xR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xL</span><span class="p">)</span>
<span class="w">    </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">dXdx</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fe_element (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="finite-element-residual-assembly">
<h1>Finite element residual assembly<a class="headerlink" href="#finite-element-residual-assembly" title="Permalink to this heading">#</a></h1>
<div class="math notranslate nohighlight">
\[ v^T F(u) \sim \int_\Omega v\cdot f_0(u, \nabla u) + \nabla v\cdot f_1(u, \nabla u) = 0, \quad \forall v\]</div>
<div class="math notranslate nohighlight">
\[ \sum_e \mathcal E_e^T \Big( B^T W \left\lvert \frac{\partial x}{\partial X} \right\rvert f_0(\tilde u, \nabla \tilde u) + D^T \left(\frac{\partial X}{\partial x}\right)^{T} W \left\lvert \frac{\partial x}{\partial X} \right\rvert f_1(\tilde u, \nabla\tilde u) \Big) = 0 \]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde u = B \mathcal E_e u\)</span> and <span class="math notranslate nohighlight">\(\nabla \tilde u = \frac{\partial X}{\partial x} D \mathcal E_e u\)</span> are the values and gradients evaluated at quadrature points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">kappa</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.6</span><span class="w"> </span><span class="o">.+</span><span class="w"> </span><span class="mf">0.4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">Du</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">*</span><span class="n">u</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">kappa</span><span class="o">.</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">Du</span>
<span class="n">dfq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">Du</span><span class="p">,</span><span class="w"> </span><span class="n">Ddu</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">*</span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">kappa</span><span class="o">.</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">Ddu</span>

<span class="k">function</span><span class="w"> </span><span class="n">fe_residual</span><span class="p">(</span><span class="n">u_in</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">fq</span><span class="p">;</span><span class="w"> </span><span class="n">bci</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">bcv</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">])</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">u_in</span><span class="p">);</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<span class="w">    </span><span class="n">u</span><span class="p">[</span><span class="n">bci</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bcv</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">fe</span><span class="o">.</span><span class="n">nelem</span>
<span class="w">        </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">dXdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_element</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">        </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">D</span>
<span class="w">        </span><span class="n">ue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u</span>
<span class="w">        </span><span class="n">uq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ue</span>
<span class="w">        </span><span class="n">Duq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dXdx</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="p">(</span><span class="n">D</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ue</span><span class="p">)</span>
<span class="w">        </span><span class="n">f0</span><span class="p">,</span><span class="w"> </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">uq</span><span class="p">,</span><span class="w"> </span><span class="n">Duq</span><span class="p">)</span>
<span class="w">        </span><span class="n">ve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">f0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">dXdx</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">f1</span><span class="p">)</span>
<span class="w">        </span><span class="n">v</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">E</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ve</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">v</span><span class="p">[</span><span class="n">bci</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_in</span><span class="p">[</span><span class="n">bci</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">bci</span><span class="p">]</span>
<span class="w">    </span><span class="n">v</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fe_residual (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="n">NLsolve</span><span class="o">:</span><span class="w"> </span><span class="n">nlsolve</span>

<span class="n">fe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FESpace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">xn</span><span class="p">)</span>
<span class="n">sol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlsolve</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fe_residual</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">fq</span><span class="p">),</span><span class="w"> </span><span class="n">u0</span><span class="p">;</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="ss">:newton</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">xn</span><span class="p">,</span><span class="w"> </span><span class="n">sol</span><span class="o">.</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">marker</span><span class="o">=</span><span class="ss">:auto</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Et = sparse([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15], [1, 2, 3, 3, 4, 5, 5, 6, 7, 7, 8, 9, 9, 10, 11], [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0], 15, 11)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">DimensionMismatch</span>: 

<span class="ne">Stacktrace</span>:
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">mul</span><span class="o">!(</span>C::Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>A::SparseMatrixCSC<span class="o">{</span>Float64,<span class="w"> </span>Int64<span class="o">}</span>,<span class="w"> </span>B::Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>α::Bool,<span class="w"> </span>β::Bool<span class="o">)</span>
    <span class="o">@</span> <span class="n">SparseArrays</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">SparseArrays</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linalg</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">31</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span>
    <span class="o">@</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">SparseArrays</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linalg</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">51</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">fe_residual</span><span class="p">(</span><span class="n">u_in</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">fe</span><span class="p">::</span><span class="n">FESpace</span><span class="p">,</span> <span class="n">fq</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">fq</span><span class="p">);</span> <span class="n">bci</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">bcv</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Main</span> <span class="o">./</span><span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span><span class="mi">11</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">fe_residual</span><span class="p">(</span><span class="n">u_in</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">fe</span><span class="p">::</span><span class="n">FESpace</span><span class="p">,</span> <span class="n">fq</span><span class="p">::</span><span class="n">Function</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Main</span> <span class="o">./</span><span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span><span class="mi">5</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="p">(::</span><span class="n">var</span><span class="s2">&quot;#4#5&quot;</span><span class="p">)(</span><span class="n">u</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Main</span> <span class="o">./</span><span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span><span class="mi">5</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="p">(::</span><span class="n">NLSolversBase</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#ff!#1&quot;</span><span class="p">{</span><span class="n">var</span><span class="s2">&quot;#4#5&quot;</span><span class="p">})(</span><span class="n">F</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">x</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">NLSolversBase</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLSolversBase</span><span class="o">/</span><span class="n">cfJrN</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">objective_types</span><span class="o">/</span><span class="n">inplace_factory</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">11</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="p">(::</span><span class="n">NLSolversBase</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#fj_finitediff!#21&quot;</span><span class="p">{</span><span class="n">NLSolversBase</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#ff!#1&quot;</span><span class="p">{</span><span class="n">var</span><span class="s2">&quot;#4#5&quot;</span><span class="p">},</span> <span class="n">FiniteDiff</span><span class="o">.</span><span class="n">JacobianCache</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">UnitRange</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">,</span> <span class="n">Val</span><span class="p">{:</span><span class="n">central</span><span class="p">}(),</span> <span class="n">Float64</span><span class="p">}})(</span><span class="n">F</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">J</span><span class="p">::</span><span class="n">Matrix</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">x</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">NLSolversBase</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLSolversBase</span><span class="o">/</span><span class="n">cfJrN</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">objective_types</span><span class="o">/</span><span class="n">oncedifferentiable</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">138</span>
  <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">value_jacobian</span><span class="o">!</span>!<span class="o">(</span>obj::NLSolversBase.OnceDifferentiable<span class="o">{</span>Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>Matrix<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>Vector<span class="o">{</span>Float64<span class="o">}}</span>,<span class="w"> </span>F::Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>J::Matrix<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>x::Vector<span class="o">{</span>Float64<span class="o">})</span>
    <span class="o">@</span> <span class="n">NLSolversBase</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLSolversBase</span><span class="o">/</span><span class="n">cfJrN</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">interface</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">124</span>
  <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="n">value_jacobian</span><span class="o">!</span>!
    <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLSolversBase</span><span class="o">/</span><span class="n">cfJrN</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">interface</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">122</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">newton_</span><span class="p">(</span><span class="n">df</span><span class="p">::</span><span class="n">NLSolversBase</span><span class="o">.</span><span class="n">OnceDifferentiable</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">Matrix</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">}},</span> <span class="n">initial_x</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">xtol</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">ftol</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">iterations</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">store_trace</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">show_trace</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">extended_trace</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">linesearch</span><span class="p">::</span><span class="n">LineSearches</span><span class="o">.</span><span class="n">Static</span><span class="p">,</span> <span class="n">linsolve</span><span class="p">::</span><span class="n">NLsolve</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#27#29&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="p">::</span><span class="n">NLsolve</span><span class="o">.</span><span class="n">NewtonCache</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">NLsolve</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLsolve</span><span class="o">/</span><span class="n">gJL1I</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">solvers</span><span class="o">/</span><span class="n">newton</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">48</span>
 <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="c1">#newton#7</span>
    <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLsolve</span><span class="o">/</span><span class="n">gJL1I</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">solvers</span><span class="o">/</span><span class="n">newton</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">146</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="n">nlsolve</span><span class="p">(</span><span class="n">df</span><span class="p">::</span><span class="n">NLSolversBase</span><span class="o">.</span><span class="n">OnceDifferentiable</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">Matrix</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">}},</span> <span class="n">initial_x</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">};</span> <span class="n">method</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">xtol</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">ftol</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">iterations</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">store_trace</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">show_trace</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">extended_trace</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">linesearch</span><span class="p">::</span><span class="n">LineSearches</span><span class="o">.</span><span class="n">Static</span><span class="p">,</span> <span class="n">linsolve</span><span class="p">::</span><span class="n">NLsolve</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#27#29&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="p">::</span><span class="n">Float64</span><span class="p">,</span> <span class="n">autoscale</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">m</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">beta</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">aa_start</span><span class="p">::</span><span class="n">Int64</span><span class="p">,</span> <span class="n">droptol</span><span class="p">::</span><span class="n">Float64</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">NLsolve</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLsolve</span><span class="o">/</span><span class="n">gJL1I</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">nlsolve</span><span class="o">/</span><span class="n">nlsolve</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">23</span>
 <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="n">nlsolve</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">initial_x</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">};</span> <span class="n">method</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">autodiff</span><span class="p">::</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">inplace</span><span class="p">::</span><span class="n">Bool</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Pairs</span><span class="p">{</span><span class="n">Symbol</span><span class="p">,</span> <span class="n">Union</span><span class="p">{},</span> <span class="n">Tuple</span><span class="p">{},</span> <span class="n">NamedTuple</span><span class="p">{(),</span> <span class="n">Tuple</span><span class="p">{}}})</span>
    <span class="o">@</span> <span class="n">NLsolve</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">NLsolve</span><span class="o">/</span><span class="n">gJL1I</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">nlsolve</span><span class="o">/</span><span class="n">nlsolve</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">52</span>
 <span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
    <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span><span class="mi">5</span>
 <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="nb">eval</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">368</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="n">include_string</span><span class="p">(</span><span class="n">mapexpr</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">REPL</span><span class="o">.</span><span class="n">softscope</span><span class="p">),</span> <span class="n">mod</span><span class="p">::</span><span class="n">Module</span><span class="p">,</span> <span class="n">code</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">filename</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">loading</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1428</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="finite-element-jacobian-assembly">
<h1>Finite element Jacobian assembly<a class="headerlink" href="#finite-element-jacobian-assembly" title="Permalink to this heading">#</a></h1>
<div class="math notranslate nohighlight">
\[ v^T F(u) \sim \int_\Omega v\cdot f_0(u, \nabla u) + \nabla v\cdot f_1(u, \nabla u) = 0, \quad \forall v\]</div>
<div class="math notranslate nohighlight">
\[ v^T J(u) du \sim \int_\Omega v\cdot df_0(u, du, \nabla u, \nabla du) + \nabla v\cdot df_1(u, du, \nabla u, \nabla du) = 0, \quad \forall v\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">fe_jacobian</span><span class="p">(</span><span class="n">u_in</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">dfq</span><span class="p">;</span><span class="w"> </span><span class="n">bci</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">bcv</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">])</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">u_in</span><span class="p">);</span><span class="w"> </span><span class="n">u</span><span class="p">[</span><span class="n">bci</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bcv</span>
<span class="w">    </span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int</span><span class="p">[],</span><span class="w"> </span><span class="kt">Int</span><span class="p">[],</span><span class="w"> </span><span class="kt">Float64</span><span class="p">[]</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">fe</span><span class="o">.</span><span class="n">nelem</span>
<span class="w">        </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="n">dXdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_element</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">        </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="o">.</span><span class="n">P</span>
<span class="w">        </span><span class="n">ue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u</span>
<span class="w">        </span><span class="n">uq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ue</span><span class="p">;</span><span class="w"> </span><span class="n">Duq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dXdx</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="p">(</span><span class="n">D</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ue</span><span class="p">)</span>
<span class="w">        </span><span class="n">K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">fe</span><span class="o">.</span><span class="n">P</span>
<span class="w">            </span><span class="n">du</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
<span class="w">            </span><span class="n">Ddu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dXdx</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
<span class="w">            </span><span class="n">df0</span><span class="p">,</span><span class="w"> </span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dfq</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">uq</span><span class="p">,</span><span class="w"> </span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">Duq</span><span class="p">,</span><span class="w"> </span><span class="n">Ddu</span><span class="p">)</span>
<span class="w">            </span><span class="n">K</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">df0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">D</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">dXdx</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="n">df1</span><span class="p">)</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">        </span><span class="n">inds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowvals</span><span class="p">(</span><span class="n">E</span><span class="o">&#39;</span><span class="p">)</span>
<span class="w">        </span><span class="n">append!</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="n">kron</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">P</span><span class="p">),</span><span class="w"> </span><span class="n">inds</span><span class="p">))</span>
<span class="w">        </span><span class="n">append!</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">kron</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="n">P</span><span class="p">)))</span>
<span class="w">        </span><span class="n">append!</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sparse</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="p">,</span><span class="w"> </span><span class="n">vals</span><span class="p">)</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">bci</span><span class="p">,</span><span class="w"> </span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">bci</span><span class="p">]</span><span class="w"> </span><span class="o">.=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">bci</span><span class="p">,</span><span class="n">bci</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">bci</span><span class="p">)))</span>
<span class="w">    </span><span class="n">A</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fe_jacobian (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nlsolve</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fe_residual</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">fq</span><span class="p">),</span>
<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fe_jacobian</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">dfq</span><span class="p">),</span>
<span class="w">    </span><span class="n">u0</span><span class="p">;</span>
<span class="w">    </span><span class="n">method</span><span class="o">=</span><span class="ss">:newton</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>DimensionMismatch: 

Stacktrace:
  [1] mul!(C::Vector{Float64}, A::SparseMatrixCSC{Float64, Int64}, B::Vector{Float64}, α::Bool, β::Bool)
    @ SparseArrays /usr/share/julia/stdlib/v1.8/SparseArrays/src/linalg.jl:31
  [2] *
    @ /usr/share/julia/stdlib/v1.8/SparseArrays/src/linalg.jl:51 [inlined]
  [3] fe_jacobian(u_in::Vector{Float64}, fe::FESpace, dfq::typeof(dfq); bci::Vector{Int64}, bcv::Vector{Float64})
    @ Main ./In[18]:7
  [4] fe_jacobian(u_in::Vector{Float64}, fe::FESpace, dfq::Function)
    @ Main ./In[18]:1
  [5] (::var&quot;#8#10&quot;)(u::Vector{Float64})
    @ Main ./In[19]:2
  [6] f!
    @ ~/.julia/packages/NLsolve/gJL1I/src/objectives/helpers.jl:6 [inlined]
  [7] (::NLSolversBase.var&quot;#fj!#7&quot;{NLsolve.var&quot;#f!#1&quot;{var&quot;#7#9&quot;}, NLsolve.var&quot;#f!#1&quot;{var&quot;#8#10&quot;}})(fx::Vector{Float64}, jx::Matrix{Float64}, x::Vector{Float64})
    @ NLSolversBase ~/.julia/packages/NLSolversBase/cfJrN/src/objective_types/abstract.jl:7
  [8] value_jacobian!!(obj::NLSolversBase.OnceDifferentiable{Vector{Float64}, Matrix{Float64}, Vector{Float64}}, F::Vector{Float64}, J::Matrix{Float64}, x::Vector{Float64})
    @ NLSolversBase ~/.julia/packages/NLSolversBase/cfJrN/src/interface.jl:124
  [9] value_jacobian!!
    @ ~/.julia/packages/NLSolversBase/cfJrN/src/interface.jl:122 [inlined]
 [10] newton_(df::NLSolversBase.OnceDifferentiable{Vector{Float64}, Matrix{Float64}, Vector{Float64}}, initial_x::Vector{Float64}, xtol::Float64, ftol::Float64, iterations::Int64, store_trace::Bool, show_trace::Bool, extended_trace::Bool, linesearch::LineSearches.Static, linsolve::NLsolve.var&quot;#27#29&quot;, cache::NLsolve.NewtonCache{Vector{Float64}})
    @ NLsolve ~/.julia/packages/NLsolve/gJL1I/src/solvers/newton.jl:48
 [11] #newton#7
    @ ~/.julia/packages/NLsolve/gJL1I/src/solvers/newton.jl:146 [inlined]
 [12] nlsolve(df::NLSolversBase.OnceDifferentiable{Vector{Float64}, Matrix{Float64}, Vector{Float64}}, initial_x::Vector{Float64}; method::Symbol, xtol::Float64, ftol::Float64, iterations::Int64, store_trace::Bool, show_trace::Bool, extended_trace::Bool, linesearch::LineSearches.Static, linsolve::NLsolve.var&quot;#27#29&quot;, factor::Float64, autoscale::Bool, m::Int64, beta::Int64, aa_start::Int64, droptol::Float64)
    @ NLsolve ~/.julia/packages/NLsolve/gJL1I/src/nlsolve/nlsolve.jl:23
 [13] nlsolve(f::Function, j::Function, initial_x::Vector{Float64}; inplace::Bool, kwargs::Base.Pairs{Symbol, Symbol, Tuple{Symbol}, NamedTuple{(:method,), Tuple{Symbol}}})
    @ NLsolve ~/.julia/packages/NLsolve/gJL1I/src/nlsolve/nlsolve.jl:67
 [14] top-level scope
    @ In[19]:1
 [15] eval
    @ ./boot.jl:368 [inlined]
 [16] include_string(mapexpr::typeof(REPL.softscope), mod::Module, code::String, filename::String)
    @ Base ./loading.jl:1428
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">fe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FESpace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">xn</span><span class="p">)</span>
<span class="k">function</span><span class="w"> </span><span class="n">mass</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">du</span><span class="p">,</span><span class="w"> </span><span class="n">Du</span><span class="p">,</span><span class="w"> </span><span class="n">Ddu</span><span class="p">)</span>
<span class="w">    </span><span class="n">df0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">du</span>
<span class="w">    </span><span class="n">df1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">*</span><span class="n">du</span>
<span class="w">    </span><span class="n">df0</span><span class="p">,</span><span class="w"> </span><span class="n">df1</span>
<span class="k">end</span>
<span class="n">fe_jacobian</span><span class="p">(</span><span class="n">zero</span><span class="o">.</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">xn</span><span class="p">),</span><span class="w"> </span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">mass</span><span class="p">,</span><span class="w"> </span><span class="n">bci</span><span class="o">=</span><span class="p">[],</span><span class="w"> </span><span class="n">bcv</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Et = sparse([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15], [1, 2, 3, 3, 4, 5, 5, 6, 7, 7, 8, 9, 9, 10, 11], [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0], 15, 11)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">DimensionMismatch</span>: 

<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">mul</span><span class="o">!(</span>C::Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>A::SparseMatrixCSC<span class="o">{</span>Float64,<span class="w"> </span>Int64<span class="o">}</span>,<span class="w"> </span>B::Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>α::Bool,<span class="w"> </span>β::Bool<span class="o">)</span>
   <span class="o">@</span> <span class="n">SparseArrays</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">SparseArrays</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linalg</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">31</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span>
   <span class="o">@</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">SparseArrays</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linalg</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">51</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">fe_jacobian</span><span class="p">(</span><span class="n">u_in</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">fe</span><span class="p">::</span><span class="n">FESpace</span><span class="p">,</span> <span class="n">dfq</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">mass</span><span class="p">);</span> <span class="n">bci</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">bcv</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">})</span>
   <span class="o">@</span> <span class="n">Main</span> <span class="o">./</span><span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span><span class="mi">7</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span><span class="mi">8</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="nb">eval</span>
   <span class="o">@</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">368</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">include_string</span><span class="p">(</span><span class="n">mapexpr</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">REPL</span><span class="o">.</span><span class="n">softscope</span><span class="p">),</span> <span class="n">mod</span><span class="p">::</span><span class="n">Module</span><span class="p">,</span> <span class="n">code</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">filename</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
   <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">loading</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1428</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diagm</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">B</span><span class="p">[</span><span class="k">end</span><span class="p">,</span><span class="o">:</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="p">]</span>
<span class="n">B</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11×10 Matrix{Float64}:
 1.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  1.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  1.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  1.0  0.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  1.0  0.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  1.0  0.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  1.0  0.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  1.0  0.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  1.0  0.0
 0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  1.0
 1.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0  0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span>
<span class="n">exp</span><span class="o">.</span><span class="p">(</span><span class="o">-</span><span class="n">fe</span><span class="o">.</span><span class="n">xn</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.^</span><span class="mi">2</span><span class="o">/</span><span class="n">sigma</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8-element Vector{Float64}:
 1.388794386496407e-11
 1.1253517471925912e-7
 0.00012340980408667956
 0.00012340980408667956
 0.01831563888873418
 0.36787944117144256
 0.36787944117144256
 1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7×7 Matrix{Float64}:
  3.46915e8  -5.63207e8   3.53942e8  …   2.97179e8  -4.30059e8   2.58474e8
 -5.63207e8   9.1506e8   -5.76891e8     -4.91434e8   7.14607e8  -4.30059e8
  3.53942e8  -5.76891e8   3.68403e8      3.31971e8  -4.91434e8   2.97179e8
 -2.63244e8   4.31923e8  -2.83171e8     -2.83171e8   4.31923e8  -2.63244e8
  2.97179e8  -4.91434e8   3.31971e8      3.68403e8  -5.76891e8   3.53942e8
 -4.30059e8   7.14607e8  -4.91434e8  …  -5.76891e8   9.1506e8   -5.63207e8
  2.58474e8  -4.30059e8   2.97179e8      3.53942e8  -5.63207e8   3.46915e8
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span><span class="w"> </span><span class="n">LinearAlgebra</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="spy-on-the-jacobian">
<h1>Spy on the Jacobian<a class="headerlink" href="#spy-on-the-jacobian" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="c">#@show cond(Matrix(J))</span>

<span class="n">fe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FESpace</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>
<span class="n">u0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">xn</span><span class="p">)</span>
<span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fe_jacobian</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span><span class="w"> </span><span class="n">fe</span><span class="p">,</span><span class="w"> </span><span class="n">dfq</span><span class="p">)</span>
<span class="n">my_spy</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Et = sparse([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24], [1, 2, 3, 4, 5, 6, 6, 7, 8, 9, 10, 11, 11, 12, 13, 14, 15, 16, 16, 17, 18, 19, 20, 21], [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0], 24, 21)
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="ne">DimensionMismatch</span>: 

<span class="ne">Stacktrace</span>:
 <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">mul</span><span class="o">!(</span>C::Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>A::SparseMatrixCSC<span class="o">{</span>Float64,<span class="w"> </span>Int64<span class="o">}</span>,<span class="w"> </span>B::Vector<span class="o">{</span>Float64<span class="o">}</span>,<span class="w"> </span>α::Bool,<span class="w"> </span>β::Bool<span class="o">)</span>
   <span class="o">@</span> <span class="n">SparseArrays</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">SparseArrays</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linalg</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">31</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span>
   <span class="o">@</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">julia</span><span class="o">/</span><span class="n">stdlib</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8</span><span class="o">/</span><span class="n">SparseArrays</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">linalg</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">51</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="n">fe_jacobian</span><span class="p">(</span><span class="n">u_in</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">fe</span><span class="p">::</span><span class="n">FESpace</span><span class="p">,</span> <span class="n">dfq</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">dfq</span><span class="p">);</span> <span class="n">bci</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">bcv</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">})</span>
   <span class="o">@</span> <span class="n">Main</span> <span class="o">./</span><span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span><span class="mi">7</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">fe_jacobian</span><span class="p">(</span><span class="n">u_in</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Float64</span><span class="p">},</span> <span class="n">fe</span><span class="p">::</span><span class="n">FESpace</span><span class="p">,</span> <span class="n">dfq</span><span class="p">::</span><span class="n">Function</span><span class="p">)</span>
   <span class="o">@</span> <span class="n">Main</span> <span class="o">./</span><span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span><span class="mi">1</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
   <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span><span class="mi">5</span>
 <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="nb">eval</span>
   <span class="o">@</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">368</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="n">include_string</span><span class="p">(</span><span class="n">mapexpr</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">REPL</span><span class="o">.</span><span class="n">softscope</span><span class="p">),</span> <span class="n">mod</span><span class="p">::</span><span class="n">Module</span><span class="p">,</span> <span class="n">code</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">filename</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
   <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">loading</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1428</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>What is interesting about this matrix structure?</p>
<ul>
<li><p>What would the matrix structure look like for a finite difference method that is 6th order accurate?</p></li>
</ul>
</li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cu-numpde/fall22",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.9"
        },
        kernelOptions: {
            name: "julia-1.9",
            path: "./slides"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.9'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="2023-10-25-galerkin.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">2023-10-25 Galerkin methods</p>
      </div>
    </a>
    <a class="right-next"
       href="2023-11-01-fem.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">2023-11-01 Finite Elements</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2023-10-30 Finite Element Theory</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#last-time">Last time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#today">Today</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#prime-to-nodal-basis">Prime to nodal basis</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-method-l-2-projection">Galerkin method: <span class="math notranslate nohighlight">\(L^2\)</span> projection</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#embed-the-solution-in-the-continuous-space">Embed the solution in the continuous space</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-error-estimates">Galerkin error estimates</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-optimality-via-energy-norms">Galerkin optimality via energy norms</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-method-for-poisson">Galerkin method for Poisson</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-we-only-impose-the-boundary-condition-on-one-side">What if we only impose the boundary condition on one side?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#galerkin-preserves-symmetry">Galerkin preserves symmetry</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-if-we-use-too-few-quadrature-points">What if we use too few quadrature points?</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#general-form">General form</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isoparametric-mapping">Isoparametric mapping</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-mesh-and-restriction">Finite element mesh and restriction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-building-blocks">Finite element building blocks</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-residual-assembly">Finite element residual assembly</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-element-jacobian-assembly">Finite element Jacobian assembly</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#spy-on-the-jacobian">Spy on the Jacobian</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jed Brown
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>